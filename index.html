<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MineraLink Map – WV Wells & Parcels</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.vectorgrid/dist/Leaflet.VectorGrid.bundled.js"></script>
  <style>
    html, body, #map {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    .leaflet-control-layers-expanded {
      font-size: 14px;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script>
  // --- Base Maps ---
  const osm = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "© OpenStreetMap contributors"
  });

  const esriSat = L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
    { attribution: "Tiles © Esri — Source: Esri, Maxar, Earthstar Geographics" }
  );

  const esriLabels = L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",
    { attribution: "Labels © Esri" }
  );

  const hybrid = L.layerGroup([esriSat, esriLabels]);

  // --- Initialize Map ---
  const map = L.map("map", {
    center: [39.036252, -79.947510], // WV center
    zoom: 10,
    layers: [hybrid]
  });

  // --- Vector Tile Layers ---
  const WV_wells = L.vectorGrid.protobuf("tiles/WV_wells/{z}/{x}/{y}.pbf", {
    vectorTileLayerStyles: {
      WV_wells: {
        color: "#ff6600",
        weight: 1,
        fill: true,
        fillColor: "#ff6600",
        fillOpacity: 0.5
      }
    },
    interactive: true,
    maxNativeZoom: 14,
    maxZoom: 19
  });

  const WV_parcels = L.vectorGrid.protobuf("tiles/WV_parcels/{z}/{x}/{y}.pbf", {
    vectorTileLayerStyles: {
      WV_parcels: {
        color: "#33cc33",
        weight: 0.5,
        fill: true,
        fillColor: "#33cc33",
        fillOpacity: 0.3
      }
    },
    interactive: true,
    maxNativeZoom: 14,
    maxZoom: 19
  });

  // --- Popup on Click ---
  function onFeatureClick(e) {
    const props = e.layer.properties || {};
    let popupContent = "<b>Feature Info:</b><br>";
    for (const key in props) {
      popupContent += `<b>${key}</b>: ${props[key]}<br>`;
    }
    L.popup().setLatLng(e.latlng).setContent(popupContent).openOn(map);
  }

  WV_wells.on("click", onFeatureClick);
  WV_parcels.on("click", onFeatureClick);

  // --- Layer Control ---
  const baseLayers = {
    "Satellite + Labels": hybrid,
    "OpenStreetMap": osm
  };

  const overlays = {
    "WV Wells": WV_wells,
    "WV Parcels": WV_parcels
  };

  L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map);

  // --- Add default overlays ---
  WV_parcels.addTo(map);
  WV_wells.addTo(map);
</script>

</body>
</html>
